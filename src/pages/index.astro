---
/**
 * PÁGINA PRINCIPAL - Composition Root
 *
 * Punto de entrada de la aplicación
 * Aquí se inyectan los datos en los componentes
 * Sigue Dependency Inversion Principle (SOLID)
 */

import Layout from '@layouts/Base.astro';
import Header from '@components/layout/Header/Header.astro';
import Hero from '@components/sections/Hero/Hero.astro';
import AnimatedBackground from '@components/layout/AnimatedBackground/AnimatedBackground.astro';
import About from '@components/sections/About/About.astro';
import Projects from '@components/sections/Projects/Projects.astro';
import Skills from '@components/sections/Skills/Skills.astro';
import Contact from '@components/sections/Contact/Contact.astro';

// Inyección de dependencias: importar datos aquí
import { personalData } from '@data/personal';
import { NAV_ITEMS } from '@data/constants';
import { sanityClient } from '@data/sanity.client';

// Obtener reseñas aprobadas desde Sanity
let reviews = [];
try {
  if (sanityClient) {
    reviews = await sanityClient.fetch(
      `*[_type == "review" && status == "approved"] | order(_createdAt desc) {
        _id,
        _type,
        authorName,
        message,
        _createdAt,
        isAnonymous,
        status
      }[0...10]`
    );
    
    // Mapear _createdAt a createdAt para consistencia con el tipo
    reviews = reviews.map((review: any) => ({
      ...review,
      createdAt: review._createdAt,
    }));
  }
} catch (error) {
  console.error('Error fetching reviews:', error);
  reviews = [];
}
---

<Layout>
  <Header navItems={NAV_ITEMS} />
  {/* Hero: inyectar datos como props */}
  <Hero personalData={personalData} />

  {/* Fondo animado solo hasta About */}
  <AnimatedBackground />

  {/* About: inyectar datos como props */}
  <About personalData={personalData} />

  {/* Secciones con fondo suave */}
  <div class="main-content">
    {/* Projects: inyectar datos como props */}
    <Projects experience={personalData.experience} socialData={personalData.social} />

    {/* Contact & Reviews */}
    <Contact initialReviews={reviews} email={personalData.email} />

    {/* Skills Footer - Carrusel profesional al final */}
    <footer class="skills-footer">
      <div class="skills-footer-content">
        <Skills skills={personalData.skills} />
      </div>
    </footer>
  </div>
</Layout>

<style>
  /* Contenido principal con fondo suave */
  .main-content {
    position: relative;
    background: linear-gradient(
      to bottom,
      rgba(180, 100, 130, 0.08) 0%,
      rgba(160, 90, 120, 0.12) 20%,
      rgba(140, 80, 110, 0.15) 50%,
      rgba(120, 70, 100, 0.12) 80%,
      rgba(100, 60, 90, 0.08) 100%
    );
    z-index: 1;
  }

  /* Skills como footer profesional */
  .skills-footer {
    position: relative;
    background: linear-gradient(180deg, transparent 0%, rgba(21, 26, 51, 0.95) 20%);
    margin-top: -1px;
    padding-top: 4rem;
  }

  .skills-footer-content {
    background: #151a33;
    border-top: 1px solid rgba(139, 92, 246, 0.2);
    padding: 3rem 0 2rem;
  }
</style>
