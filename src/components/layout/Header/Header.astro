---
import type { NavItem } from '@data/types';
import styles from './Header.module.css';

interface Props {
  navItems: NavItem[];
}

const { navItems } = Astro.props;
---

<header class={styles.header}>
  <div class={styles.container}>
    <nav class={styles.nav}>
      <!-- Logo -->
      <a href="/" class={styles.logo}>
        <span class={styles.logoText}>
          <span class={styles.textGradient}>Eddy</span>
          <span class={styles.logoDot}>.</span>dev
        </span>
      </a>

      <!-- Desktop Navigation -->
      <ul class={`${styles.navLinks} hide-mobile`}>
        {navItems.map((item) => (
          <li>
            <a href={item.href} class={styles.navLink}>
              {item.label}
            </a>
          </li>
        ))}
      </ul>

      <!-- CTA Button -->
      <div class={`${styles.navCta} hide-mobile`}>
        <a href="#contact" class={styles.ctaButton}>
          Hablemos
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button class={`${styles.mobileMenuBtn} hide-desktop`} aria-label="Abrir menÃº">
        <span class={styles.hamburger}></span>
      </button>
    </nav>
  </div>

  <!-- Mobile Menu -->
  <div class={styles.mobileMenu}>
    <ul class={styles.mobileNavLinks}>
      {navItems.map((item) => (
        <li>
          <a href={item.href} class={styles.mobileNavLink}>
            {item.label}
          </a>
        </li>
      ))}
      <li>
        <a href="#contact" class={styles.mobileCta}>
          Platiquemos soy eddy
        </a>
      </li>
    </ul>
  </div>
</header>

<script>
  (function() {
    function initMobileMenu() {
      var mobileMenuBtn = document.querySelector('button[class*="mobileMenuBtn"]');
      var mobileMenu = document.querySelector('div[class*="mobileMenu"]');
      var header = document.querySelector('header');

      if (!mobileMenuBtn || !mobileMenu) return;

      var isMenuOpen = false;

      // Toggle menu
      mobileMenuBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        isMenuOpen = !isMenuOpen;
        mobileMenuBtn.setAttribute('data-open', isMenuOpen);
        mobileMenu.setAttribute('data-open', isMenuOpen);
        document.body.style.overflow = isMenuOpen ? 'hidden' : '';
      });

      // Close menu when clicking a link
      var links = mobileMenu.querySelectorAll('a');
      for (var i = 0; i < links.length; i++) {
        links[i].addEventListener('click', function() {
          isMenuOpen = false;
          mobileMenuBtn.removeAttribute('data-open');
          mobileMenu.removeAttribute('data-open');
          document.body.style.overflow = '';
        });
      }

      // Close menu when clicking outside
      document.addEventListener('click', function(e) {
        if (isMenuOpen) {
          var target = e.target;
          if (mobileMenu !== target && !mobileMenu.contains(target) &&
              mobileMenuBtn !== target && !mobileMenuBtn.contains(target)) {
            isMenuOpen = false;
            mobileMenuBtn.removeAttribute('data-open');
            mobileMenu.removeAttribute('data-open');
            document.body.style.overflow = '';
          }
        }
      });

      // Scroll effect
      var lastScroll = 0;
      window.addEventListener('scroll', function() {
        var currentScroll = window.pageYOffset;
        if (header) {
          if (currentScroll > 50) {
            header.classList.add('scrolled');
          } else {
            header.classList.remove('scrolled');
          }
        }
        lastScroll = currentScroll;
      });

      // Smooth scroll for anchor links
      var anchors = document.querySelectorAll('a[href^="#"]');
      for (var j = 0; j < anchors.length; j++) {
        anchors[j].addEventListener('click', function(e) {
          e.preventDefault();
          var href = this.getAttribute('href');
          if (href) {
            var target = document.querySelector(href);
            if (target) {
              var headerOffset = 80;
              var elementPosition = target.getBoundingClientRect().top;
              var offsetPosition = elementPosition + window.pageYOffset - headerOffset;
              window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
            }
          }
        });
      }
    }

    document.addEventListener('astro:page-load', initMobileMenu);
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMobileMenu);
    } else {
      initMobileMenu();
    }
  })();
</script>
