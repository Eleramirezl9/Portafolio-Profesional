---
import type { NavItem } from '@data/types';
import styles from './Header.module.css';

interface Props {
  navItems: NavItem[];
}

const { navItems } = Astro.props;
---

<header class={styles.header}>
  <div class={styles.container}>
    <nav class={styles.nav}>
      <!-- Logo -->
      <a href="/" class={styles.logo}>
        <span class={styles.logoText}>
          <span class={styles.textGradient}></span>
        </span>
      </a>

      <!-- Desktop Navigation -->
      <ul class={`${styles.navLinks} hide-mobile`}>
        {navItems.map((item) => (
          <li>
            <a href={item.href} class={styles.navLink}>
              {item.label}
            </a>
          </li>
        ))}
      </ul>

      <!-- CTA Button -->
      <div class={`${styles.navCta} hide-mobile`}>
        <a href="#contact" class={styles.ctaButton}>
          Hablemos
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button class={`${styles.mobileMenuBtn} hide-desktop`} aria-label="Abrir menÃº">
        <span class={styles.hamburger}></span>
      </button>
    </nav>
  </div>

  <!-- Mobile Menu -->
  <div class={styles.mobileMenu}>
    <ul class={styles.mobileNavLinks}>
      {navItems.map((item) => (
        <li>
          <a href={item.href} class={styles.mobileNavLink}>
            {item.label}
          </a>
        </li>
      ))}
      <li>
        <a href="#contact" class={styles.mobileCta}>
          Platiquemos soy eddy
        </a>
      </li>
    </ul>
  </div>
</header>

<script>
  function initMobileMenu() {
    const mobileMenuBtn = document.querySelector<HTMLButtonElement>('button[class*="mobileMenuBtn"]');
    const mobileMenu = document.querySelector<HTMLDivElement>('div[class*="mobileMenu"]');
    const header = document.querySelector<HTMLElement>('header');

    if (!mobileMenuBtn || !mobileMenu) return;

    let isMenuOpen = false;

    // Toggle menu
    mobileMenuBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      isMenuOpen = !isMenuOpen;
      mobileMenuBtn.setAttribute('data-open', String(isMenuOpen));
      mobileMenu.setAttribute('data-open', String(isMenuOpen));
      document.body.style.overflow = isMenuOpen ? 'hidden' : '';
    });

    // Close menu when clicking a link
    const links = mobileMenu.querySelectorAll('a');
    links.forEach((link) => {
      link.addEventListener('click', () => {
        isMenuOpen = false;
        mobileMenuBtn.removeAttribute('data-open');
        mobileMenu.removeAttribute('data-open');
        document.body.style.overflow = '';
      });
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (isMenuOpen) {
        const target = e.target as Node;
        if (mobileMenu !== target && !mobileMenu.contains(target) &&
            mobileMenuBtn !== target && !mobileMenuBtn.contains(target)) {
          isMenuOpen = false;
          mobileMenuBtn.removeAttribute('data-open');
          mobileMenu.removeAttribute('data-open');
          document.body.style.overflow = '';
        }
      }
    });

    // Scroll effect
    let lastScroll = 0;
    window.addEventListener('scroll', () => {
      const currentScroll = window.pageYOffset;
      if (currentScroll > 50) {
        header?.classList.add('scrolled');
      } else {
        header?.classList.remove('scrolled');
      }
      lastScroll = currentScroll;
    });

    // Smooth scroll for anchor links
    const anchors = document.querySelectorAll<HTMLAnchorElement>('a[href^="#"]');
    anchors.forEach((anchor) => {
      anchor.addEventListener('click', (e) => {
        e.preventDefault();
        const href = anchor.getAttribute('href');
        if (href) {
          const target = document.querySelector<HTMLElement>(href);
          if (target) {
            const headerOffset = 80;
            const elementPosition = target.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
            window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
          }
        }
      });
    });
  }

  document.addEventListener('astro:page-load', initMobileMenu);
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMobileMenu);
  } else {
    initMobileMenu();
  }
</script>
